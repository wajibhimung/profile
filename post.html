<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Artikel — Wibowo Laksono</title>
  <meta name="description" content="Baca artikel blog di situs ini tanpa pindah ke halaman lain.">
  <meta name="theme-color" content="#0f172a">
  <script>
    // Early theme apply to avoid flash of wrong theme
    (function() {
      try {
        var t = localStorage.getItem('theme');
        // Default to dark when no saved preference
        if (!t) { t = 'dark'; }
        if (t === 'dark') { document.documentElement.classList.add('dark'); if (document.body) document.body.classList.add('dark'); }
        else { document.documentElement.classList.remove('dark'); if (document.body) document.body.classList.remove('dark'); }
        // Sync theme-color on initial load
        var meta = document.querySelector('meta[name="theme-color"]');
        if (meta) meta.setAttribute('content', t === 'dark' ? '#0f172a' : '#f8fafc');
        // Tailwind Play CDN config (define BEFORE CDN script so darkMode:'class' is honored)
        var tailwind = window.tailwind || {};
        tailwind.config = { darkMode: 'class' };
        window.tailwind = tailwind;
      } catch (e) {}
    })();
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Reinforce Tailwind to use class-based dark mode after CDN loads
    try { tailwind.config = Object.assign({}, tailwind.config || {}, { darkMode: 'class' }); } catch(e) { window.tailwind = { config: { darkMode: 'class' } }; }
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    html { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans'; }
    :root { color-scheme: light dark; }
    .bg-grid { background-image: radial-gradient(rgba(99,102,241,0.15) 1px, transparent 1px); background-size: 18px 18px; }
    body { opacity: 0; transition: opacity .25s ease; }
    body.ready { opacity: 1; }
  /* Reading progress bar */
  #read-progress { position: fixed; top: 0; left: 0; right: 0; height: 3px; z-index: 70; pointer-events: none; }
  #read-progress .bar { height: 100%; width: 0%; background: linear-gradient(90deg, #4f46e5, #8b5cf6); box-shadow: 0 1px 0 rgba(0,0,0,.04); transition: width .1s linear; }
  .dark #read-progress .bar { background: linear-gradient(90deg, #6366f1, #a78bfa); }
  /* Pull to refresh (compact near-top with stroke progress ring) */
  #pull-refresh { position: fixed; top:0; left:0; right:0; height:0; overflow:visible; z-index:90; pointer-events:none; }
  #pull-refresh .inner { margin:0 auto; width:100%; max-width:840px; display:flex; justify-content:center; }
  #pull-refresh .bubble { margin-top:10px; width:46px; height:46px; border-radius:9999px; background:linear-gradient(135deg,#6366f1,#8b5cf6); display:flex; align-items:center; justify-content:center; color:white; box-shadow:0 4px 16px -2px rgba(0,0,0,.35); opacity:0; transform:translateY(-18px) scale(.75); transition:opacity .25s ease, transform .28s cubic-bezier(.4,0,.2,1), background .25s ease; position:relative; will-change:transform; }
  .dark #pull-refresh .bubble { background:linear-gradient(135deg,#4f46e5,#7c3aed); }
  #pull-refresh.ready .bubble { background:linear-gradient(135deg,#10b981,#059669); }
  #pull-refresh.show .bubble { opacity:1; }
  #pull-refresh .icon { width:26px; height:26px; transition: transform .25s cubic-bezier(.4,0,.2,1); will-change:transform; }
  #pull-refresh.loading .icon { animation: spin 1s linear infinite; }
  #pull-refresh .progress { position:absolute; inset:0; transform:rotate(-90deg); }
  #pull-refresh .progress circle { fill:none; stroke-width:3; }
  #pull-refresh .progress .track { stroke:rgba(255,255,255,.25); transition:stroke .25s ease; }
  #pull-refresh.ready .progress .track { stroke:rgba(255,255,255,.35); }
  #pull-refresh .progress .bar { stroke:rgba(255,255,255,.85); stroke-linecap:round; stroke-dasharray:126; stroke-dashoffset:126; transition: stroke-dashoffset .12s linear; }
  #pull-refresh.loading .progress { animation: pr-spin .9s linear infinite; }
  #pull-refresh.loading .progress .bar { stroke-dashoffset:25 !important; transition:none; }
  @keyframes pr-spin { to { transform: rotate(270deg); } }
  .dark #pull-refresh .progress .track { stroke:rgba(255,255,255,.28); }
  .dark #pull-refresh .progress .bar { stroke:rgba(255,255,255,.9); }
  @keyframes spin { to { transform: rotate(360deg); } }
    .content img { max-width: 100%; height: auto; border-radius: 0.5rem; }
    .content iframe { max-width: 100%; }
    .content figure { margin: 1rem 0; }
    .content h1, .content h2, .content h3 { margin-top: 1.25rem; font-weight: 700; }
    .content p { margin-top: 0.75rem; line-height: 1.75; }
    .content ul { list-style: disc; padding-left: 1.25rem; margin-top: .5rem; }
    .content ol { list-style: decimal; padding-left: 1.25rem; margin-top: .5rem; }
    .content a { color: #4f46e5; text-decoration: underline; }
  /* Toast notification */
  #toast-root { position: fixed; top: .75rem; left: 0; right: 0; display: flex; flex-direction: column; align-items: center; gap: .5rem; z-index: 100; pointer-events: none; }
  /* Base toast now adapts to theme */
  .toast { pointer-events: auto; background: #ffffff; color: #0f172a; padding: .55rem .9rem; font-size: .70rem; font-weight: 600; border-radius: 9999px; box-shadow: 0 4px 12px -2px rgba(0,0,0,.15), 0 2px 4px -1px rgba(0,0,0,.08); display: inline-flex; align-items: center; gap: .5rem; letter-spacing:.3px; position: relative; overflow:hidden; border:1px solid rgba(15,23,42,.08); }
  .dark .toast { background: #1e293b; color: #f1f5f9; box-shadow: 0 4px 12px -2px rgba(0,0,0,.4), 0 2px 4px -1px rgba(0,0,0,.3); border:1px solid rgba(255,255,255,.08); }
  .toast::after { content:""; position:absolute; inset:0; background:linear-gradient(120deg,rgba(255,255,255,0.08),rgba(255,255,255,0)); opacity:0; animation: sheen 2.4s ease 0.2s forwards; }
  @keyframes sheen { 0%{transform:translateX(-60%); opacity:0;} 30%{opacity:1;} 60%{opacity:0;} 100%{transform:translateX(120%); opacity:0;} }
  .toast-enter { opacity:0; transform: translateY(-6px) scale(.96); animation: toast-in .35s cubic-bezier(.4,.0,.2,1) forwards; }
  @keyframes toast-in { to { opacity:1; transform: translateY(0) scale(1); } }
  .toast-exit { opacity:1; transform: translateY(0) scale(1); animation: toast-out .32s cubic-bezier(.4,.0,.2,1) forwards; }
  @keyframes toast-out { to { opacity:0; transform: translateY(-4px) scale(.96); } }
  .toast .bar { position:absolute; left:0; bottom:0; height:2px; background:linear-gradient(90deg,#6366f1,#8b5cf6); width:100%; transform-origin:left; animation: bar 3.2s linear forwards; }
  .dark .toast .bar { background:linear-gradient(90deg,#818cf8,#a78bfa); }
  @keyframes bar { to { transform: scaleX(0); } }
  </style>
  <link rel="icon" href="https://www.smkn1telagasari.sch.id/wp-content/uploads/2022/07/199207302020121021-300x300.png" type="image/png">
  <link rel="apple-touch-icon" href="https://www.smkn1telagasari.sch.id/wp-content/uploads/2022/07/199207302020121021-300x300.png">
  <meta property="og:type" content="article">
  <meta property="og:title" content="Artikel — Wibowo Laksono">
  <meta property="og:description" content="Baca artikel blog di situs ini.">
  <meta property="og:image" content="https://me.kelastkj.online/profile.png">
  <link rel="manifest" href="manifest.json">
</head>
 <body class="min-h-screen bg-gradient-to-b from-white to-slate-50 dark:from-slate-900 dark:to-slate-950 text-slate-900 dark:text-slate-100">
  <!-- Thin top reading progress bar -->
  <div id="read-progress" aria-hidden="true">
    <div id="read-bar" class="bar"></div>
  </div>
  <div class="absolute inset-0 bg-grid [mask-image:radial-gradient(ellipse_at_center,black,transparent_60%)] pointer-events-none"></div>

  <main class="relative mx-auto w-full max-w-3xl px-4 sm:px-6 py-6">
    <!-- Pull to refresh indicator -->
  <div id="pull-refresh" aria-hidden="true"><div class="inner"><div class="bubble"><svg class="progress" viewBox="0 0 44 44" aria-hidden="true"><circle class="track" cx="22" cy="22" r="20"/><circle class="bar" cx="22" cy="22" r="20"/></svg><div class="icon"></div></div></div></div>
    <header class="flex items-center justify-between gap-3">
      <div class="flex items-center gap-2">
        <button id="back" class="inline-flex items-center gap-2 rounded-full bg-slate-100 text-slate-900 dark:bg-slate-800 dark:text-slate-100 px-3 py-1.5 text-xs border border-slate-200 dark:border-slate-700 hover:bg-white dark:hover:bg-slate-700 transition">⬅️ Kembali</button>
      </div>
      <div class="flex items-center gap-1">
        <button id="theme-toggle" aria-label="Ubah tema" title="Ubah tema" class="inline-flex items-center justify-center w-8 h-8 text-slate-700 dark:text-slate-200 hover:text-slate-900 dark:hover:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500/50 rounded-md">
          <!-- Sun icon -->
          <svg class="sun" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 4.5a1 1 0 0 1 1 1V7a1 1 0 1 1-2 0V5.5a1 1 0 0 1 1-1Zm0 11a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Zm7.5-3.5a1 1 0 0 1-1 1H17a1 1 0 1 1 0-2h1.5a1 1 0 0 1 1 1ZM12 17a1 1 0 0 1 1 1v1.5a1 1 0 1 1-2 0V18a1 1 0 0 1 1-1Zm-6.5-5.5a1 1 0 0 1 1-1H8a1 1 0 1 1 0 2H6.5a1 1 0 0 1-1-1Zm10.61-4.61a1 1 0 0 1 1.41 0l1.06 1.06a1 1 0 0 1-1.41 1.41L15.7 8.3a1 1 0 0 1 0-1.41Zm-9.42 9.42a1 1 0 0 1 1.41 0l1.06 1.06a1 1 0 0 1-1.41 1.41L6.2 17.7a1 1 0 0 1 0-1.41Zm11.89 1.41a1 1 0 0 1-1.41-1.41l1.06-1.06a1 1 0 0 1 1.41 1.41L18.58 17.3Zm-11.16-11.16a1 1 0 0 1-1.41 1.41L4.95 6.49A1 1 0 0 1 6.36 5.08l1.06 1.06Z"/>
          </svg>
          <!-- Moon icon -->
          <svg class="moon hidden" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path d="M21 12.8A8.5 8.5 0 0 1 11.2 3a.75.75 0 0 0-1.02.86 7 7 0 1 0 9.96 9.96.75.75 0 0 0 .86-1.02Z"/>
          </svg>
        </button>
    <button id="save-toggle" aria-label="Simpan untuk offline" title="Simpan untuk offline" class="inline-flex items-center justify-center w-8 h-8 p-0 bg-transparent text-slate-700 dark:text-slate-200 hover:text-slate-900 dark:hover:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500/40 hidden">
          <span class="icon-unsaved" aria-hidden="true">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
              <path d="M17 21l-5-3-5 3V5a2 2 0 012-2h6a2 2 0 012 2v16z"/>
            </svg>
          </span>
          <span class="icon-saved hidden" aria-hidden="true">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path d="M7 3a2 2 0 00-2 2v16l7-4 7 4V5a2 2 0 00-2-2H7z"/>
            </svg>
          </span>
        </button>
        <button id="share-btn" aria-label="Bagikan" title="Bagikan" class="inline-flex items-center justify-center w-8 h-8 p-0 bg-transparent text-slate-700 dark:text-slate-200 hover:text-indigo-600 dark:hover:text-indigo-300 focus:outline-none focus:ring-2 focus:ring-indigo-500/40">
          <!-- Common share/nodes icon -->
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
            <circle cx="18" cy="5" r="3" />
            <circle cx="6" cy="12" r="3" />
            <circle cx="18" cy="19" r="3" />
            <path d="M8.59 13.51 15.42 17.5" />
            <path d="M15.41 6.5 8.59 10.49" />
          </svg>
        </button>
        <a id="open-original" href="#" target="_blank" rel="noreferrer" aria-label="Buka di Blogger" title="Buka di Blogger" class="inline-flex items-center justify-center w-8 h-8 p-0 bg-transparent text-slate-700 dark:text-slate-200 hover:text-indigo-600 dark:hover:text-indigo-300 focus:outline-none focus:ring-2 focus:ring-indigo-500/40 hidden">
          <!-- Clean external link icon (feather style) for consistent geometry -->
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
            <path d="M18 13v6a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h6" />
            <path d="M15 3h6v6" />
            <path d="M10 14 21 3" />
          </svg>
        </a>
      </div>
    </header>

  <article class="mt-5 rounded-2xl border border-slate-200 dark:border-slate-800 bg-white/70 dark:bg-slate-900/60 shadow-sm overflow-hidden">
      <div class="p-5 sm:p-7">
        <h1 id="title" class="text-xl sm:text-2xl font-extrabold tracking-tight">Memuat…</h1>
        <p id="meta" class="mt-1 text-[12px] text-slate-500 dark:text-slate-400"></p>
  <span id="saved-badge" class="mt-2 inline-flex items-center rounded-full bg-emerald-600 text-white px-2.5 py-1 text-[11px] font-semibold hidden">Tersimpan</span>
        <!-- Article skeleton -->
        <div id="article-skeleton" class="mt-3 space-y-3 animate-pulse">
          <div class="h-6 bg-slate-200 dark:bg-slate-800 rounded w-3/4"></div>
          <div class="h-3 bg-slate-200 dark:bg-slate-800 rounded w-1/3"></div>
          <div class="mt-2 space-y-2">
            <div class="h-4 bg-slate-200 dark:bg-slate-800 rounded"></div>
            <div class="h-4 bg-slate-200 dark:bg-slate-800 rounded w-11/12"></div>
            <div class="h-4 bg-slate-200 dark:bg-slate-800 rounded w-10/12"></div>
            <div class="h-4 bg-slate-200 dark:bg-slate-800 rounded w-7/12"></div>
          </div>
        </div>
        <div id="content" class="content mt-4 text-[15px]"></div>
        <div id="error" class="mt-4 text-sm text-red-600 hidden"></div>

        <!-- Bottom meta and actions -->
        <hr class="mt-6 border-slate-200 dark:border-slate-800">
        <section id="post-bottom" class="mt-4 space-y-4">
          <!-- Labels -->
          <div id="labels-wrap" class="hidden">
            <div class="text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1">Label</div>
            <div id="labels" class="flex flex-wrap gap-2"></div>
          </div>
        </section>
      </div>
    </article>

    <!-- Related posts -->
    <section class="mt-6">
      <h2 class="text-base font-semibold">Baca juga</h2>
      <!-- Related skeleton -->
      <div id="related-skeleton" class="mt-3 grid grid-cols-1 sm:grid-cols-2 gap-4 animate-pulse">
        <div class="rounded-xl border border-slate-200 dark:border-slate-800 bg-white/70 dark:bg-slate-900/60 overflow-hidden flex gap-3">
          <div class="h-20 w-28 bg-slate-200 dark:bg-slate-800"></div>
          <div class="p-3 pr-4 flex-1 space-y-2">
            <div class="h-4 bg-slate-200 dark:bg-slate-800 rounded w-full"></div>
            <div class="h-4 bg-slate-200 dark:bg-slate-800 rounded w-4/5"></div>
          </div>
        </div>
        <div class="rounded-xl border border-slate-200 dark:border-slate-800 bg-white/70 dark:bg-slate-900/60 overflow-hidden flex gap-3">
          <div class="h-20 w-28 bg-slate-200 dark:bg-slate-800"></div>
          <div class="p-3 pr-4 flex-1 space-y-2">
            <div class="h-4 bg-slate-200 dark:bg-slate-800 rounded w-full"></div>
            <div class="h-4 bg-slate-200 dark:bg-slate-800 rounded w-4/5"></div>
          </div>
        </div>
      </div>
      <div id="related-grid" class="mt-3 grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
      <div id="related-empty" class="mt-3 text-sm text-slate-500 hidden">Tidak ada rekomendasi.</div>
    </section>

    <!-- Bottom navigation / footer -->
    <footer class="mt-8 flex items-center justify-between text-xs text-slate-500 dark:text-slate-400">
      <a href="index.html?view=blog" class="inline-flex items-center gap-1 hover:underline">← Kembali ke daftar Blog</a>
      <div>© <span id="year"></span> Wibowo Laksono</div>
    </footer>
  </main>

  <script>
    // PWA: register service worker (same scope as index)
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js').catch(()=>{});
      });
    }

    // Fade-in
    document.addEventListener('DOMContentLoaded', () => {
      requestAnimationFrame(() => document.body.classList.add('ready'));
    });

    function navigateSmooth(url) {
      if ('startViewTransition' in document) {
        // @ts-ignore
        document.startViewTransition(() => { window.location.href = url; });
      } else {
        document.body.classList.remove('ready');
        setTimeout(() => { window.location.href = url; }, 180);
      }
    }
  document.getElementById('back')?.addEventListener('click', () => navigateSmooth('index.html?view=blog'));

  const elTitle = document.getElementById('title');
    const elMeta = document.getElementById('meta');
    const elContent = document.getElementById('content');
  const elErr = document.getElementById('error');
  const openOriginal = document.getElementById('open-original');
  const shareBtn = document.getElementById('share-btn');
  const labelsWrap = document.getElementById('labels-wrap');
  const labelsEl = document.getElementById('labels');
  const relatedGrid = document.getElementById('related-grid');
  const relatedEmpty = document.getElementById('related-empty');
  const articleSkeleton = document.getElementById('article-skeleton');
  const relatedSkeleton = document.getElementById('related-skeleton');
  const saveToggle = document.getElementById('save-toggle');
  const savedBadge = document.getElementById('saved-badge');
  // Saved entries storage keys mirror index.html
  const LS_SAVED_SET = 'savedPostIds';
  const LS_SAVED_ENTRIES = 'savedPostEntries';
  function loadSavedSet(){ try { return new Set(JSON.parse(localStorage.getItem(LS_SAVED_SET) || '[]')); } catch { return new Set(); } }
  function saveSavedSet(set){ try { localStorage.setItem(LS_SAVED_SET, JSON.stringify(Array.from(set))); } catch {} }
  function loadSavedEntries(){ try { return JSON.parse(localStorage.getItem(LS_SAVED_ENTRIES) || '[]'); } catch { return []; } }
  function upsertSavedEntry(entryObj){ try { const list = loadSavedEntries(); const idx = list.findIndex(x => x.idKey === entryObj.idKey); if (idx >= 0) list[idx] = entryObj; else list.push(entryObj); localStorage.setItem(LS_SAVED_ENTRIES, JSON.stringify(list)); } catch {} }
  function removeSavedEntry(idKey){ try { const list = loadSavedEntries(); const next = list.filter(x => x.idKey !== idKey); localStorage.setItem(LS_SAVED_ENTRIES, JSON.stringify(next)); } catch {} }
  const savedIds = loadSavedSet();
  // === Pull to refresh ===
  (function setupPullToRefresh(){
    const el = document.getElementById('pull-refresh'); if(!el) return;
    const bubble = el.querySelector('.bubble'); const iconBox = el.querySelector('.icon'); const bar = el.querySelector('.progress .bar');
    function postSvg(){ return `<svg width=\"26\" height=\"26\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M7 4h7l3 3v13a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1Z\"/><path d=\"M9 12h6M9 16h6M9 8h2\"/></svg>`; }
    if(iconBox) iconBox.innerHTML = postSvg();
  let startY=0, startX=0, pulling=false, dist=0; const THRESH=70; let loading=false; const CIRC=126;
    function maxTravel(){ return 90; }
    function resetBubble(){ if(bubble){ bubble.style.transform='translateY(-18px) scale(.75)'; } if(iconBox){ iconBox.style.transform='scale(0.75)'; } if(bar){ bar.style.strokeDashoffset = CIRC; } }
    function setState(){
  if(loading){ el.classList.add('loading'); el.classList.remove('ready'); if(bar){ bar.style.strokeDashoffset = 25; } return; }
      el.classList.toggle('show', pulling && dist>2);
      const pct = Math.min(dist/THRESH,1);
      const travel = Math.min(dist*0.55, maxTravel());
      const eased = (pct < 1) ? (1 - Math.pow(1 - pct, 1.8)) : 1;
      if(bubble) bubble.style.transform = `translateY(${pulling?travel:-18}px) scale(${(0.75 + eased*0.25).toFixed(3)})`;
      if(iconBox) iconBox.style.transform = `scale(${(0.75 + eased*0.25).toFixed(3)})`;
      if(bar){ bar.style.strokeDashoffset = ((1-eased)*CIRC).toFixed(1); }
      if(pulling && dist>=THRESH) el.classList.add('ready'); else el.classList.remove('ready');
      if(!pulling && !loading){ resetBubble(); }
    }
    function onStart(e){
      if(loading) return;
      if(window.scrollY>0) return; // only when at top
      if(e.touches && e.touches.length!==1) return; // ignore multi-touch
      const t=e.touches?e.touches[0]:null; if(!t) return;
      startY=t.clientY; startX=t.clientX; pulling=true; dist=0; setState();
    }
    function onMove(e){
      if(!pulling) return;
      if(e.touches && e.touches.length!==1){ pulling=false; dist=0; setState(); return; }
      const t=e.touches?e.touches[0]:null; if(!t) return;
      dist = t.clientY - startY;
      const dx = t.clientX - startX;
      if(Math.abs(dx) > Math.abs(dist) && Math.abs(dx) > 10 && dist < 40){
        pulling=false; dist=0; setState(); return;
      }
      if(dist>0){
        if(dist>10 && window.scrollY===0) e.preventDefault();
        setState();
      } else {
        dist=0; pulling=false; setState();
      }
    }
    function doReload(){ loading=true; setState(); setTimeout(()=>location.reload(), 420); }
    function onEnd(){
      if(!pulling) return;
      if(dist>=THRESH){ doReload(); }
      else { pulling=false; dist=0; setState(); }
    }
    window.addEventListener('touchstart', onStart, {passive:true});
    window.addEventListener('touchmove', onMove, {passive:false});
    window.addEventListener('touchend', onEnd, {passive:true});
  })();
  // Toast helper
  function showToast(message){
    try {
      let root = document.getElementById('toast-root');
      if(!root){
        root = document.createElement('div');
        root.id = 'toast-root';
        root.setAttribute('role','status');
        root.setAttribute('aria-live','polite');
        document.body.appendChild(root);
      }
      const el = document.createElement('div');
      el.className = 'toast toast-enter';
      el.innerHTML = `<span>${message}</span><span class="bar" aria-hidden="true"></span>`;
      root.appendChild(el);
      const ttl = 3200; // ms
      setTimeout(()=>{ el.classList.remove('toast-enter'); el.classList.add('toast-exit'); }, ttl-350);
      setTimeout(()=>{ el.remove(); }, ttl);
      // Hard cap: remove older if more than 3 stacked
      const toasts = root.querySelectorAll('.toast');
      if(toasts.length>3){ for(let i=0;i<toasts.length-3;i++){ toasts[i].remove(); } }
    } catch {}
  }
  function getSavedSnapshot(bid, pid, url){
    try {
      const list = loadSavedEntries();
      if (bid && pid) {
        const idKey = `${bid}:${pid}`;
        const found = list.find(x => x.idKey === idKey);
        if (found) return found;
      }
      if (url) {
        const found2 = list.find(x => x.link === url);
        if (found2) return found2;
      }
    } catch {}
    return null;
  }
  document.getElementById('year').textContent = new Date().getFullYear();

  // === Reading progress bar ===
  (function setupReadingProgress(){
    const bar = document.getElementById('read-bar');
    if (!bar) return;
    let ticking = false;
    function calcProgress(){
      const doc = document.documentElement;
      const scrollTop = doc.scrollTop || window.pageYOffset || 0;
      const scrollHeight = doc.scrollHeight || 0;
      const clientH = window.innerHeight || doc.clientHeight || 0;
      const total = Math.max(scrollHeight - clientH, 1);
      const p = Math.min(100, Math.max(0, (scrollTop / total) * 100));
      bar.style.width = p.toFixed(2) + '%';
    }
    function onScroll(){ if (!ticking) { window.requestAnimationFrame(() => { calcProgress(); ticking = false; }); ticking = true; } }
    window.addEventListener('scroll', onScroll, { passive: true });
    window.addEventListener('resize', onScroll);
    // Initial draw
    calcProgress();
    // Recalculate after images load in content
    const content = document.getElementById('content');
    if (content) {
      const imgs = content.querySelectorAll('img');
      if (imgs.length) {
        let remaining = imgs.length;
        imgs.forEach(img => {
          if (img.complete) { remaining--; return; }
          img.addEventListener('load', onScroll);
          img.addEventListener('error', onScroll);
        });
        if (remaining === 0) onScroll();
      }
      // Observe size changes (if content expands/collapses)
      try {
        const ro = new ResizeObserver(() => onScroll());
        ro.observe(content);
      } catch {}
    }
  })();

  // === Theme toggle ===
  (function setupThemeToggle(){
    const btn = document.getElementById('theme-toggle');
    if (!btn) return;
    const sun = btn.querySelector('.sun');
    const moon = btn.querySelector('.moon');
    const metaTheme = document.querySelector('meta[name="theme-color"]');

    function getTheme(){ return document.documentElement.classList.contains('dark') ? 'dark' : 'light'; }
    function updateIcon(theme){
      if (!sun || !moon) return;
      if (theme === 'dark') { sun.classList.add('hidden'); moon.classList.remove('hidden'); btn.setAttribute('aria-label','Ubah ke mode terang'); }
      else { moon.classList.add('hidden'); sun.classList.remove('hidden'); btn.setAttribute('aria-label','Ubah ke mode gelap'); }
    }
    function updateThemeColor(theme){ if (metaTheme) metaTheme.setAttribute('content', theme === 'dark' ? '#0f172a' : '#f8fafc'); }
    function setTheme(theme){
      if (theme === 'dark') { document.documentElement.classList.add('dark'); document.body.classList.add('dark'); }
      else { document.documentElement.classList.remove('dark'); document.body.classList.remove('dark'); }
      try { localStorage.setItem('theme', theme); } catch(e){}
      updateIcon(theme);
      updateThemeColor(theme);
    }
    btn.addEventListener('click', function(){ setTheme(getTheme() === 'dark' ? 'light' : 'dark'); });
    // Initialize icon and theme-color state
    const initial = getTheme();
    updateIcon(initial);
    updateThemeColor(initial);
  })();


  let currentBid = null;
  let currentPid = null;
  let currentAltUrl = null;

    function jsonp(url, cb) {
      const cbName = 'handleEntry_' + Math.random().toString(36).slice(2);
      const s = document.createElement('script');
      const cleanup = () => { delete window[cbName]; s.remove(); };
      window[cbName] = (data) => { cleanup(); cb(null, data); };
      s.onerror = () => { cleanup(); cb(new Error('JSONP gagal')); };
      s.src = url + (url.includes('?') ? '&' : '?') + 'callback=' + cbName;
      document.body.appendChild(s);
    }

    function stripHtml(html) {
      const div = document.createElement('div');
      div.innerHTML = html;
      return (div.textContent || div.innerText || '').trim();
    }

    function extractThumb(html) {
      try {
        const doc = new DOMParser().parseFromString(html, 'text/html');
        const img = doc.querySelector('img');
        return img ? img.src : null;
      } catch { return null; }
    }

    function formatDate(isoStr) {
      if (!isoStr) return '';
      const d = new Date(isoStr);
      if (isNaN(d.getTime())) return '';
      return d.toLocaleDateString('id-ID', { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' });
    }

    // Inject JSON-LD <script> into <head>
    function injectArticleJsonLd(data) {
      try {
        let el = document.getElementById('ld-article');
        if (!el) {
          el = document.createElement('script');
          el.type = 'application/ld+json';
          el.id = 'ld-article';
          document.head.appendChild(el);
        }
        el.textContent = JSON.stringify(data);
      } catch {}
    }

  // No hero image above title per user request

  function hideArticleSkeleton(){ articleSkeleton?.classList.add('hidden'); }
  function hideRelatedSkeleton(){ relatedSkeleton?.classList.add('hidden'); }

  function renderEntry(entry) {
      const title = entry.title?.$t || 'Tanpa judul';
      const dateStr = entry.published?.$t || entry.updated?.$t || '';
      const dateLabel = formatDate(dateStr);
      const author = (entry.author && entry.author[0] && entry.author[0].name?.$t) ? entry.author[0].name.$t : '';
      const contentHtml = entry.content?.$t || entry.summary?.$t || '';
  const thumb = entry.media$thumbnail?.url || extractThumb(contentHtml) || null;
      const altLink = (entry.link || []).find(l => l.rel === 'alternate')?.href || null;
      currentAltUrl = altLink || window.location.href;
      // Try get IDs from entry.id
      const idText = entry.id?.$t || '';
      const m = idText.match(/blog-(\d+)\.post-(\d+)/);
      if (m) { currentBid = m[1]; currentPid = m[2]; }

      document.title = title + ' — Wibowo Laksono';
      elTitle.textContent = title;
      // Calculate reading time & description
      const plain = stripHtml(contentHtml);
      const words = plain.split(/\s+/).filter(Boolean).length;
      const readMin = Math.max(1, Math.round(words / 200));
      const metaParts = [dateLabel, author, readMin + ' menit baca'];
      elMeta.textContent = metaParts.filter(Boolean).join(' • ');
  elContent.innerHTML = contentHtml;
  // hero removed
      if (altLink) { openOriginal.href = altLink; openOriginal.classList.remove('hidden'); }

      // Build and inject JSON-LD for richer SEO
      const description = plain.length > 160 ? (plain.slice(0, 157) + '…') : plain;
      const ld = {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "headline": title,
        "datePublished": entry.published?.$t || undefined,
        "dateModified": entry.updated?.$t || undefined,
        "author": author ? { "@type": "Person", "name": author } : undefined,
        "image": thumb ? [thumb] : undefined,
        "mainEntityOfPage": { "@type": "WebPage", "@id": currentAltUrl || window.location.href },
        "url": currentAltUrl || window.location.href,
        "description": description
      };
      injectArticleJsonLd(ld);

      // Prepare share data
      if (shareBtn) {
        // Always use local page URL so shared link tetap di dalam aplikasi ini
  const shareUrl = window.location.href.split('#')[0];
        shareBtn.onclick = async () => {
          try {
            if (navigator.share && typeof navigator.share === 'function') {
              await navigator.share({ title, text: title, url: shareUrl });
              return;
            }
          } catch {}
          // Fallback: open WhatsApp share
            const waMessage = `${title}\n\n${shareUrl}`;
            const wa = `https://wa.me/?text=${encodeURIComponent(waMessage)}`;
            try { window.open(wa, '_blank', 'noopener'); } catch { location.href = wa; }
        };
      }

      // Saved badge + toggle setup
      try {
        const bid = currentBid; const pid = currentPid;
        const idKey = (bid && pid) ? `${bid}:${pid}` : (title + '|' + (currentAltUrl || ''));
        const isSaved = savedIds.has(idKey);
        if (saveToggle) {
          saveToggle.classList.remove('hidden');
          const unsavedIcon = saveToggle.querySelector('.icon-unsaved');
          const savedIcon = saveToggle.querySelector('.icon-saved');
          const setIconState = (saved) => {
            if (saved) {
              unsavedIcon?.classList.add('hidden');
              savedIcon?.classList.remove('hidden');
              saveToggle.setAttribute('aria-label','Hapus dari tersimpan');
              saveToggle.setAttribute('title','Hapus dari tersimpan');
            } else {
              savedIcon?.classList.add('hidden');
              unsavedIcon?.classList.remove('hidden');
              saveToggle.setAttribute('aria-label','Simpan untuk offline');
              saveToggle.setAttribute('title','Simpan untuk offline');
            }
          };
          setIconState(isSaved);
          saveToggle.onclick = () => {
            const nowSaved = savedIds.has(idKey);
            if (nowSaved) {
              savedIds.delete(idKey);
              saveSavedSet(savedIds);
              removeSavedEntry(idKey);
              setIconState(false);
              savedBadge?.classList.add('hidden');
              showToast('Artikel dihapus dari tersimpan');
            } else {
              savedIds.add(idKey);
              saveSavedSet(savedIds);
              // Build snapshot (similar to index.html)
              const labels = Array.isArray(entry.category) ? entry.category.map(c=>c.term).filter(Boolean) : [];
              const excerptSrc = stripHtml(entry.content?.$t || entry.summary?.$t || '');
              const excerpt = excerptSrc.length > 110 ? (excerptSrc.slice(0,110) + '…') : excerptSrc;
              const snapshot = {
                idKey,
                bid: bid || '',
                pid: pid || '',
                title,
                link: currentAltUrl || '',
                thumb: ld.image && ld.image.length ? ld.image[0] : (extractThumb(entry.content?.$t || '') || ''),
                date: entry.published?.$t || entry.updated?.$t || '',
                excerpt,
                entry: {
                  t: title,
                  c: entry.content?.$t || entry.summary?.$t || '',
                  s: entry.summary?.$t || '',
                  pub: entry.published?.$t || '',
                  upd: entry.updated?.$t || '',
                  a: (entry.author && entry.author[0] && entry.author[0].name?.$t) ? entry.author[0].name.$t : '',
                  labels
                }
              };
              upsertSavedEntry(snapshot);
              setIconState(true);
              savedBadge?.classList.remove('hidden');
              showToast('Artikel disimpan untuk offline');
              // Ask SW to cache JSONP of this post
              try {
                if (bid && pid && navigator.serviceWorker) {
                  const jsonpUrl = `https://www.blogger.com/feeds/${encodeURIComponent(bid)}/posts/default/${encodeURIComponent(pid)}?alt=json-in-script`;
                  if (navigator.serviceWorker.controller) {
                    navigator.serviceWorker.controller.postMessage({ type: 'CACHE_POSTS', urls: [jsonpUrl] });
                  } else {
                    navigator.serviceWorker.ready.then(reg => reg.active && reg.active.postMessage({ type: 'CACHE_POSTS', urls: [jsonpUrl] })).catch(()=>{});
                  }
                }
              } catch {}
            }
          };
        }
        if (savedBadge) {
          if (isSaved) savedBadge.classList.remove('hidden');
          else savedBadge.classList.add('hidden');
        }
      } catch {}

  // Labels
      const labels = Array.isArray(entry.category) ? entry.category.map(c => c.term).filter(Boolean) : [];
      if (labels.length) {
        labelsWrap.classList.remove('hidden');
        labelsEl.innerHTML = '';
        labels.forEach(l => {
          const a = document.createElement('span');
          a.textContent = l;
          a.className = 'inline-flex items-center rounded-full bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-200 px-2.5 py-1 text-[11px] border border-slate-200 dark:border-slate-700';
          labelsEl.appendChild(a);
        });
      }

  // share buttons removed as requested

  hideArticleSkeleton();
  // Update progress after content injected
      try { window.dispatchEvent(new Event('resize')); } catch {}
  // Load related posts
      loadRelated();
    }

    function showError(msg) {
      elErr.textContent = msg;
      elErr.classList.remove('hidden');
    }

    function toLocalLinkByEntry(entry, fallbackUrl) {
      const idText = entry.id?.$t || '';
      const m = idText.match(/blog-(\d+)\.post-(\d+)/);
      if (m) {
        const bid = m[1];
        const pid = m[2];
        return `post.html?bid=${encodeURIComponent(bid)}&pid=${encodeURIComponent(pid)}`;
      }
      return `post.html?url=${encodeURIComponent(fallbackUrl || '')}`;
    }

    function createRelatedCard(e) {
      const title = e.title?.$t || 'Tanpa judul';
      const link = (e.link || []).find(l => l.rel === 'alternate')?.href || '#';
      const content = e.content?.$t || e.summary?.$t || '';
      let thumb = e.media$thumbnail?.url || extractThumb(content) || null;
      if (thumb && thumb.startsWith('https://blogger.googleusercontent.com/img/b/')) {
        thumb = thumb.replace(/\/s\d+(?=-)/, '/s800');
      }
      const localHref = toLocalLinkByEntry(e, link);
      const el = document.createElement('a');
      el.href = localHref;
      el.className = 'group rounded-xl border border-slate-200 dark:border-slate-800 bg-white/70 dark:bg-slate-900/60 overflow-hidden shadow-sm hover:shadow transition flex gap-3';
      el.innerHTML = `
        ${thumb ? `<img src="${thumb}" alt="" class="h-20 w-28 object-cover">` : `<div class="h-20 w-28 bg-slate-100 dark:bg-slate-800"></div>`}
        <div class="p-3 pr-4">
          <div class="text-[13px] font-semibold group-hover:underline line-clamp-2">${title}</div>
        </div>`;
      return el;
    }

    function loadRelated() {
      const cacheKey = 'related:latest';
      const url = `https://wajibhimung.blogspot.com/feeds/posts/default?alt=json-in-script&max-results=6`;

      // try cache first
      try {
        const cached = sessionStorage.getItem(cacheKey);
        if (cached) {
          const data = JSON.parse(cached);
          renderRelated(data);
          // SWR: revalidate quietly
          fetchRelatedAndCache(cacheKey, url);
          return;
        }
      } catch {}

      // no cache: fetch via JSONP
      fetchRelatedAndCache(cacheKey, url, true);
    }

    function fetchRelatedAndCache(cacheKey, url, showSkeleton) {
      if (showSkeleton) relatedSkeleton?.classList.remove('hidden');
      jsonp(url, (err, data) => {
        if (err) { hideRelatedSkeleton(); return; }
        try { sessionStorage.setItem(cacheKey, JSON.stringify(data)); } catch {}
        renderRelated(data);
      });
    }

    function renderRelated(data) {
      const entries = (data && data.feed && data.feed.entry) ? data.feed.entry : [];
      const filtered = entries.filter(e => {
        const idText = e.id?.$t || '';
        const m = idText.match(/blog-(\d+)\.post-(\d+)/);
        const pid = m ? m[2] : null;
        return !currentPid || pid !== currentPid;
      }).slice(0, 3);
      hideRelatedSkeleton();
      if (!filtered.length) { relatedEmpty.classList.remove('hidden'); return; }
      relatedGrid.innerHTML = '';
      const frag = document.createDocumentFragment();
      filtered.forEach(e => frag.appendChild(createRelatedCard(e)));
      relatedGrid.appendChild(frag);
    }

    (function init() {
      const q = new URLSearchParams(window.location.search);
      const bid = q.get('bid');
      const pid = q.get('pid');
      if (bid && pid) {
        const url = `https://www.blogger.com/feeds/${encodeURIComponent(bid)}/posts/default/${encodeURIComponent(pid)}?alt=json-in-script`;
        // cache key per artikel
        const cacheKey = `post:${bid}:${pid}`;
        const saved = getSavedSnapshot(bid, pid, null);
        // try session cache first
        try {
          const cached = sessionStorage.getItem(cacheKey);
          if (cached) {
            const entry = JSON.parse(cached);
            currentBid = bid; currentPid = pid;
            renderEntry(entry);
            // SWR revalidate
            fetchPostAndCache(url, cacheKey);
            return;
          }
        } catch {}
        // use saved snapshot if offline or as immediate fallback
        if (saved && saved.entry) {
          const entry = {
            title: { $t: saved.entry.t },
            content: { $t: saved.entry.c || saved.entry.s || '' },
            summary: { $t: saved.entry.s || '' },
            published: { $t: saved.entry.pub || '' },
            updated: { $t: saved.entry.upd || '' },
            author: saved.entry.a ? [{ name: { $t: saved.entry.a } }] : undefined,
            category: Array.isArray(saved.entry.labels) ? saved.entry.labels.map(l => ({ term: l })) : undefined,
            id: { $t: `tag:blogger.com,1999:blog-${bid}.post-${pid}` },
            link: [{ rel: 'alternate', href: saved.link || '' }],
            media$thumbnail: saved.thumb ? { url: saved.thumb } : undefined
          };
          currentBid = bid; currentPid = pid; currentAltUrl = saved.link || null;
          renderEntry(entry);
          // try to revalidate in background if online
          if (navigator.onLine) fetchPostAndCache(url, cacheKey);
          return;
        }
        // else: fetch jsonp (will show error if offline and no saved)
        fetchPostAndCache(url, cacheKey, true, () => { currentBid = bid; currentPid = pid; });
        return;
      }
      // Fallback: try from feed and match by "url" param (if provided)
      const urlParam = q.get('url');
      if (urlParam) {
        const feedUrl = `https://wajibhimung.blogspot.com/feeds/posts/default?alt=json-in-script&max-results=50`;
        const cacheKey = `postByUrl:${urlParam}`;
        const saved = getSavedSnapshot(null, null, urlParam);
        try {
          const cached = sessionStorage.getItem(cacheKey);
          if (cached) {
            const entry = JSON.parse(cached);
            renderEntry(entry);
            fetchPostByUrlAndCache(feedUrl, cacheKey, urlParam);
            return;
          }
        } catch {}
        if (saved && saved.entry) {
          const entry = {
            title: { $t: saved.entry.t },
            content: { $t: saved.entry.c || saved.entry.s || '' },
            summary: { $t: saved.entry.s || '' },
            published: { $t: saved.entry.pub || '' },
            updated: { $t: saved.entry.upd || '' },
            author: saved.entry.a ? [{ name: { $t: saved.entry.a } }] : undefined,
            category: Array.isArray(saved.entry.labels) ? saved.entry.labels.map(l => ({ term: l })) : undefined,
            id: { $t: `tag:blogger.com,1999:by-url` },
            link: [{ rel: 'alternate', href: saved.link || urlParam }],
            media$thumbnail: saved.thumb ? { url: saved.thumb } : undefined
          };
          currentAltUrl = saved.link || urlParam;
          renderEntry(entry);
          if (navigator.onLine) fetchPostByUrlAndCache(feedUrl, cacheKey, urlParam);
          return;
        }
        fetchPostByUrlAndCache(feedUrl, cacheKey, urlParam, true);
        return;
      }
      showError('Parameter artikel tidak valid.');
    })();
    function fetchPostAndCache(url, cacheKey, showSkel, beforeRenderCb) {
      if (showSkel) articleSkeleton?.classList.remove('hidden');
      jsonp(url, (err, data) => {
        if (err) { showError('Gagal memuat artikel.'); return; }
        const entry = data && (data.entry || (data.feed && data.feed.entry && data.feed.entry[0]));
        if (!entry) { showError('Artikel tidak ditemukan.'); return; }
        try { sessionStorage.setItem(cacheKey, JSON.stringify(entry)); } catch {}
        if (typeof beforeRenderCb === 'function') beforeRenderCb();
        renderEntry(entry);
      });
    }

    function fetchPostByUrlAndCache(feedUrl, cacheKey, urlParam, showSkel) {
      if (showSkel) articleSkeleton?.classList.remove('hidden');
      jsonp(feedUrl, (err, data) => {
        if (err) { showError('Gagal memuat artikel.'); return; }
        const entries = (data && data.feed && data.feed.entry) ? data.feed.entry : [];
        const found = entries.find(e => (e.link || []).some(l => l.rel === 'alternate' && l.href === urlParam));
        if (!found) { showError('Artikel tidak ditemukan.'); return; }
        try { sessionStorage.setItem(cacheKey, JSON.stringify(found)); } catch {}
        renderEntry(found);
      });
    }
  </script>
</body>
 </html>
